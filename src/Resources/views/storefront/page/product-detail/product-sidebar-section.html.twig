{% block wow_boost_menu %}

<script src="https://cdn.jsdelivr.net/npm/swiper@11/swiper-bundle.min.js"></script>
<div class="wow-boost-menu" data-wow-boost-menu="true">
    <!-- Header -->
    <div class="wow-boost-header">
        <button class="back-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M15 18L9 12L15 6" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Back to Choose Game
        </button>
        <div class="service-title">
            <span class="wow-icon">W</span>
            WoW Boost Service
        </div>
    </div>

    <!-- Swiper Container -->
    <div class="swiper wow-menu-swiper">
        <div class="swiper-wrapper">
            <!-- Gold Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Gold</h3>
                </div>
            </div>

            <!-- The War Within Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">The War Within</h3>
                </div>
            </div>

            <!-- Leveling Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Leveling</h3>
                </div>
            </div>

            <!-- Raids Slide -->
            <div class="swiper-slide">
                <div class="menu-category expandable">
                    <div class="category-header">
                        <h3 class="category-title">Raids</h3>
                        <button class="expand-button">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="subcategories">
                        <div class="subcategory-item">Nerub-ar Palace</div>
                        <div class="subcategory-item">Awakened</div>
                        <div class="subcategory-item">Amirdrassil</div>
                    </div>
                </div>
            </div>

            <!-- Aberrus Slide -->
            <div class="swiper-slide">
                <div class="menu-category expandable">
                    <div class="category-header">
                        <h3 class="category-title">Aberrus</h3>
                        <button class="expand-button">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                            </svg>
                        </button>
                    </div>
                    <div class="subcategories">
                        <div class="subcategory-item">Normal</div>
                        <div class="subcategory-item heroic">Heroic</div>
                        <div class="subcategory-item mythic">Mythic+</div>
                    </div>
                </div>
            </div>

            <!-- Vault Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Vault</h3>
                </div>
            </div>

            <!-- Transmog/Timewalking Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Timewalking</h3>
                    <span class="badge">Limited</span>
                </div>
            </div>

            <!-- Dungeons Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Dungeons</h3>
                </div>
            </div>

            <!-- Pandaria Remix Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <div class="category-header">
                        <h3 class="category-title">Pandaria Remix</h3>
                        <button class="add-button">
                            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                                <path d="M12 5V19M5 12H19" stroke="currentColor" stroke-width="2" stroke-linecap="round"/>
                            </svg>
                        </button>
                    </div>
                </div>
            </div>

            <!-- Awakened Raids Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Awakened Raids</h3>
                </div>
            </div>

            <!-- Quests & Farm Slide -->
            <div class="swiper-slide">
                <div class="menu-category">
                    <h3 class="category-title">Quests & Farm</h3>
                </div>
            </div>
        </div>
    </div>

    <!-- Show All Button -->
    <div class="menu-footer">
        <button class="show-all-button">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none">
                <path d="M6 9L12 15L18 9" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
            </svg>
            Show All
        </button>
    </div>
</div>

<style>
.wow-boost-menu {
    background: #2a2d3a;
    color: #ffffff;
    border-radius: 8px;
    overflow: hidden;
    font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
}

.wow-boost-header {
    padding: 16px 20px;
    border-bottom: 1px solid #3a3d4a;
}

.back-button {
    display: flex;
    align-items: center;
    gap: 8px;
    background: none;
    border: none;
    color: #9ca3af;
    font-size: 14px;
    cursor: pointer;
    margin-bottom: 12px;
    padding: 0;
}

.back-button:hover {
    color: #ffffff;
}

.service-title {
    display: flex;
    align-items: center;
    gap: 12px;
    font-size: 18px;
    font-weight: 600;
}

.wow-icon {
    width: 32px;
    height: 32px;
    background: #f59e0b;
    border-radius: 6px;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: bold;
    font-size: 16px;
    color: #000;
}

.wow-menu-swiper {
    padding: 0;
}

.swiper-slide {
    height: auto;
}

.menu-category {
    padding: 16px 20px;
    border-bottom: 1px solid #3a3d4a;
    transition: background-color 0.2s ease;
}

.menu-category:hover {
    background: #323544;
    cursor: pointer;
}

.category-header {
    display: flex;
    align-items: center;
    justify-content: space-between;
}

.category-title {
    font-size: 16px;
    font-weight: 500;
    margin: 0;
    color: #ffffff;
}

.expand-button,
.add-button {
    background: none;
    border: none;
    color: #9ca3af;
    cursor: pointer;
    padding: 4px;
    border-radius: 4px;
    transition: color 0.2s ease;
}

.expand-button:hover,
.add-button:hover {
    color: #ffffff;
    background: #3a3d4a;
}

.subcategories {
    margin-top: 12px;
    padding-left: 16px;
}

.subcategory-item {
    padding: 8px 0;
    font-size: 14px;
    color: #d1d5db;
    cursor: pointer;
    transition: color 0.2s ease;
}

.subcategory-item:hover {
    color: #ffffff;
}

.subcategory-item.heroic {
    color: #ef4444;
}

.subcategory-item.mythic {
    color: #8b5cf6;
}

.badge {
    background: #f59e0b;
    color: #000;
    font-size: 12px;
    font-weight: 600;
    padding: 2px 8px;
    border-radius: 12px;
    margin-left: 8px;
}

.menu-footer {
    padding: 16px 20px;
    border-top: 1px solid #3a3d4a;
}

.show-all-button {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 8px;
    width: 100%;
    background: none;
    border: none;
    color: #9ca3af;
    font-size: 14px;
    cursor: pointer;
    padding: 8px;
    border-radius: 6px;
    transition: all 0.2s ease;
}

.show-all-button:hover {
    color: #ffffff;
    background: #3a3d4a;
}

/* Swiper customization */
.wow-menu-swiper .swiper-wrapper {
    flex-direction: column;
}

.wow-menu-swiper .swiper-slide {
    width: 100%;
    height: auto;
}
</style>

<script>
// Инициализация для случаев, когда плагин не зарегистрирован глобально
document.addEventListener('DOMContentLoaded', function() {
    // Проверяем доступность Swiper
    if (typeof Swiper === 'undefined') {
        console.warn('Swiper.js не загружен. Убедитесь, что библиотека подключена.');
        return;
    }

    // Initialize Swiper
    const swiper = new Swiper('.wow-menu-swiper', {
        direction: 'vertical',
        slidesPerView: 'auto',
        freeMode: true,
        mousewheel: {
            enabled: true,
            sensitivity: 1,
            eventsTarget: '.wow-menu-swiper'
        },
        scrollbar: {
            el: '.swiper-scrollbar',
            draggable: true,
        },
    });

    // Handle expandable categories
    document.querySelectorAll('.expand-button').forEach(button => {
        button.addEventListener('click', function(e) {
            e.stopPropagation();
            const category = this.closest('.menu-category');
            const subcategories = category.querySelector('.subcategories');
            const isExpanded = subcategories.style.display === 'block';
            
            if (isExpanded) {
                // Collapse
                subcategories.style.transition = 'all 0.3s ease';
                subcategories.style.opacity = '0';
                subcategories.style.transform = 'translateY(-10px)';
                
                setTimeout(() => {
                    subcategories.style.display = 'none';
                    swiper.update();
                }, 300);
                
                this.style.transform = 'rotate(0deg)';
            } else {
                // Expand
                subcategories.style.display = 'block';
                subcategories.style.opacity = '0';
                subcategories.style.transform = 'translateY(-10px)';
                
                requestAnimationFrame(() => {
                    subcategories.style.transition = 'all 0.3s ease';
                    subcategories.style.opacity = '1';
                    subcategories.style.transform = 'translateY(0)';
                });
                
                this.style.transform = 'rotate(180deg)';
                
                setTimeout(() => {
                    swiper.update();
                }, 300);
            }
        });
    });

    // Handle menu item clicks
    document.querySelectorAll('.menu-category').forEach(item => {
        item.addEventListener('click', function(e) {
            // Don't trigger if clicking on expand button or subcategory
            if (e.target.closest('.expand-button') || e.target.closest('.subcategory-item')) {
                return;
            }
            
            const categoryName = this.querySelector('.category-title').textContent;
            console.log('Menu item clicked:', categoryName);
            
            // Add visual feedback
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = '';
            }, 100);
            
            // Dispatch custom event
            const event = new CustomEvent('wowBoostMenuCategoryClick', {
                detail: { categoryName, categoryElement: this }
            });
            document.dispatchEvent(event);
        });
    });

    // Handle subcategory clicks
    document.querySelectorAll('.subcategory-item').forEach(item => {
        item.addEventListener('click', function(e) {
            e.stopPropagation();
            const subcategoryName = this.textContent;
            console.log('Subcategory clicked:', subcategoryName);
            
            // Add visual feedback
            this.style.transform = 'scale(0.98)';
            setTimeout(() => {
                this.style.transform = '';
            }, 100);
            
            // Dispatch custom event
            const event = new CustomEvent('wowBoostMenuSubcategoryClick', {
                detail: { subcategoryName, subcategoryElement: this }
            });
            document.dispatchEvent(event);
        });
    });

    // Handle show all button
    const showAllButton = document.querySelector('.show-all-button');
    if (showAllButton) {
        showAllButton.addEventListener('click', function(e) {
            const icon = this.querySelector('svg');
            if (icon) {
                const currentRotation = icon.style.transform;
                icon.style.transform = currentRotation === 'rotate(180deg)' ? 'rotate(0deg)' : 'rotate(180deg)';
            }
            
            // Dispatch custom event
            const event = new CustomEvent('wowBoostMenuShowAllClick', {
                detail: { button: this }
            });
            document.dispatchEvent(event);
        });
    }

    // Handle back button
    const backButton = document.querySelector('.back-button');
    if (backButton) {
        backButton.addEventListener('click', function(e) {
            console.log('Back button clicked');
            
            // Dispatch custom event
            const event = new CustomEvent('wowBoostMenuBackClick', {
                detail: { button: this }
            });
            document.dispatchEvent(event);
        });
    }
});
</script>
{% endblock %}