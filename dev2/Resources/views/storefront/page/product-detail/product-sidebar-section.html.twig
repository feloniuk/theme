{% block wow_boost_menu %}

{# DETAILED DEBUG INFORMATION #}
<div style="background: red; color: white; padding: 10px; margin: 10px; font-size: 12px;">
    <h3>üîç DETAILED DEBUG SIDEBAR:</h3>
    
    <div style="background: rgba(0,0,0,0.3); padding: 10px; margin: 5px 0;">
        <h4>Basic Info:</h4>
        <p>sidebarEnabled: {{ sidebarEnabled ? 'YES' : 'NO' }}</p>
        <p>sidebarCategories: {{ sidebarCategories is null ? 'NULL' : (sidebarCategories is empty ? 'EMPTY ARRAY' : sidebarCategories|length) }}</p>
        <p>contextCategory: {{ contextCategory ? 'EXISTS' : 'NULL' }}</p>
        <p>currentCategoryId: {{ currentCategoryId ? currentCategoryId : 'NULL' }}</p>
        <p>Active Route: {{ activeRoute }}</p>
        <p>Controller: {{ controllerName|default('NONE') }}</p>
    </div>

    {% if debugInfo is defined %}
        <div style="background: rgba(0,0,0,0.3); padding: 10px; margin: 5px 0;">
            <h4>Current Category:</h4>
            {% if debugInfo.currentCategory %}
                <p>Name: {{ debugInfo.currentCategory.name }}</p>
                <p>ID: {{ debugInfo.currentCategory.id }}</p>
                <p>Level: {{ debugInfo.currentCategory.level }}</p>
                <p>Parent ID: {{ debugInfo.currentCategory.parentId ?? 'ROOT' }}</p>
                {% if debugInfo.currentCategory.breadcrumb %}
                    <p>Breadcrumb: {{ debugInfo.currentCategory.breadcrumb|join(' > ') }}</p>
                {% endif %}
            {% else %}
                <p style="color: yellow;">NO CURRENT CATEGORY</p>
            {% endif %}
        </div>

        <div style="background: rgba(0,0,0,0.3); padding: 10px; margin: 5px 0;">
            <h4>üîç Search Results:</h4>
            {% for name, result in debugInfo.searchResults %}
                <div style="margin: 5px 0; padding: 5px; background: rgba(255,255,255,0.1);">
                    <strong>"{{ name }}":</strong>
                    {% if result.found %}
                        <span style="color: #90EE90;">‚úÖ FOUND</span>
                        <br>‚Ä¢ ID: {{ result.id }}
                        <br>‚Ä¢ Level: {{ result.level }}
                        <br>‚Ä¢ Has Children: {{ result.hasChildren ? 'YES' : 'NO' }}
                    {% else %}
                        <span style="color: #FFB6C1;">‚ùå NOT FOUND</span>
                    {% endif %}
                </div>
            {% endfor %}
        </div>

        <div style="background: rgba(0,0,0,0.3); padding: 10px; margin: 5px 0;">
            <h4>‚öôÔ∏è Custom Field:</h4>
            <p>mm_root_games_category: 
                {% if debugInfo.customField == 'NOT SET' %}
                    <span style="color: #FFB6C1;">NOT SET</span>
                {% else %}
                    <span style="color: #90EE90;">{{ debugInfo.customField }}</span>
                {% endif %}
            </p>
        </div>

        <div style="background: rgba(0,0,0,0.3); padding: 10px; margin: 5px 0;">
            <h4>üìã All Top Level Categories (Level 2):</h4>
            {% if debugInfo.allTopLevelCategories is empty %}
                <p style="color: #FFB6C1;">NO CATEGORIES FOUND AT LEVEL 2</p>
            {% else %}
                {% for category in debugInfo.allTopLevelCategories %}
                    <div style="margin: 3px 0; padding: 3px; background: rgba(255,255,255,0.05);">
                        ‚Ä¢ {{ category.name }} 
                        <small>(ID: {{ category.id }}, Level: {{ category.level }}, Children: {{ category.hasChildren ? 'YES' : 'NO' }})</small>
                    </div>
                {% endfor %}
            {% endif %}
        </div>

        <div style="background: rgba(255,165,0,0.8); color: black; padding: 10px; margin: 5px 0;">
            <h4>üí° RECOMMENDED ACTIONS:</h4>
            <ol style="margin: 0; padding-left: 20px;">
                {% set foundAny = false %}
                {% for name, result in debugInfo.searchResults %}
                    {% if result.found %}
                        {% set foundAny = true %}
                        <li>Found "{{ name }}" - check if it has child categories</li>
                    {% endif %}
                {% endfor %}
                
                {% if not foundAny %}
                    <li>Create a category named "Choose Game" or "Games"</li>
                    <li>Make sure it's active and has child categories</li>
                    <li>OR set mm_root_games_category custom field in sales channel</li>
                {% endif %}
                
                {% if debugInfo.customField != 'NOT SET' %}
                    <li>Custom field is set - check if category with ID {{ debugInfo.customField }} exists and is active</li>
                {% endif %}
            </ol>
        </div>
    {% endif %}
</div>

{% if sidebarEnabled %}
<div class="wow-boost-menu" data-wow-boost-menu 
     {% if currentCategoryId %}data-current-category="{{ currentCategoryId }}"{% endif %}
     {% if contextCategory %}data-context-category="{{ contextCategory.id }}"{% endif %}>

    <!-- Menu Content with Scroll -->
    <div class="wow-menu-content">
        {% if contextCategory %}
            {# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—É—é –∫–∞—Ç–µ–≥–æ—Ä–∏—é (–∏–≥—Ä—É) –∫–æ–≥–¥–∞ –º—ã –≤–Ω—É—Ç—Ä–∏ –ø—Ä–æ–¥—É–∫—Ç–∞ –∏–ª–∏ –ø–æ–¥–∫–∞—Ç–µ–≥–æ—Ä–∏–∏ #}
            {% set category = contextCategory %}
            {% set name = category.name %}
            {% set categoryId = category.id %}
            {% set hasChildren = category.hasChildren %}
            {% set customFields = category.customFields %}
            
            <div class="menu-category context-category active-parent" 
                 data-category-id="{{ categoryId }}"
                 {% if not hasChildren %}data-category-url="{{ category.url }}"{% endif %}
                 {% if hasChildren %}data-expandable="true"{% endif %}
                 {% if categoryId == currentCategoryId %}data-current="true"{% endif %}>
                
                <div class="category-header">
                    {% if category.iconId is defined %}
                        {% set mediaCollection = searchMedia([category.iconId], context.context) %}
                        {% if mediaCollection.count > 0 %}
                            {% set iconImage = mediaCollection.first %}
                            <div class="category-icon">
                                <img src="{{ iconImage.url }}" alt="{{ name }}" loading="lazy">
                            </div>
                        {% endif %}
                    {% endif %}
                    
                    <span class="category-title{% if customFields.mm_theme_sidebar_bold %} font-bold{% endif %}">
                        {{ name }}
                        {% if categoryId == currentCategoryId %}
                            <span class="current-indicator">‚Ä¢</span>
                        {% endif %}
                    </span>
                    
                    {% if hasChildren %}
                        <button class="expand-button expanded" data-expand-button>
                            <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                <path d="M2 8L14 8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                            </svg>
                        </button>
                    {% endif %}
                </div>
                
                {% if hasChildren and category.children %}
                    <div class="subcategories context-expanded" data-subcategories style="display: block;">
                        {% for firstLevelItem in category.children %}
                            {% set firstLevelId = firstLevelItem.id %}
                            {% set firstLevelName = firstLevelItem.name %}
                            {% set hasSubChildren = firstLevelItem.hasChildren %}
                            {% set firstLevelCustomFields = firstLevelItem.customFields %}
                            
                            {% if hasSubChildren %}
                                {# Category with subcategories #}
                                <div class="subcategory-group{% if firstLevelId == currentCategoryId %} active-parent{% endif %}" data-subcategory-group>
                                    <div class="subcategory-title" 
                                         data-subcategory-id="{{ firstLevelId }}"
                                         data-subcategory-url="{{ firstLevelItem.url }}"
                                         data-expandable="true"
                                         {% if firstLevelId == currentCategoryId %}data-current="true"{% endif %}>
                                        <span class="{% if firstLevelCustomFields.mm_theme_sidebar_bold %}font-bold{% endif %}">
                                            {{ firstLevelName }}
                                            {% if firstLevelId == currentCategoryId %}
                                                <span class="current-indicator">‚Ä¢</span>
                                            {% endif %}
                                        </span>
                                        
                                        {# –ü—Ä–æ–≤–µ—Ä—è–µ–º, –µ—Å—Ç—å –ª–∏ —Ç–µ–∫—É—â–∞—è –∫–∞—Ç–µ–≥–æ—Ä–∏—è —Å—Ä–µ–¥–∏ –¥–µ—Ç–µ–π #}
                                        {% set shouldExpand = false %}
                                        {% if firstLevelItem.children %}
                                            {% for secondLevelItem in firstLevelItem.children %}
                                                {% if secondLevelItem.id == currentCategoryId %}
                                                    {% set shouldExpand = true %}
                                                    {% break %}
                                                {% endif %}
                                            {% endfor %}
                                        {% endif %}
                                        
                                        <button class="subcategory-expand{% if shouldExpand or firstLevelId == currentCategoryId %} expanded{% endif %}" data-subcategory-expand>
                                            {% if shouldExpand or firstLevelId == currentCategoryId %}
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                    <path d="M2 8L14 8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                                </svg>
                                            {% else %}
                                                <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                    <path d="M8 2V14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                                    <path d="M2 8L14 8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                                </svg>
                                            {% endif %}
                                        </button>
                                    </div>
                                    <div class="subcategory-items" data-subcategory-items 
                                         {% if shouldExpand or firstLevelId == currentCategoryId %}style="display: block;"{% endif %}>
                                        {% if firstLevelItem.children %}
                                            {% for secondLevelItem in firstLevelItem.children %}
                                                {% set secondLevelId = secondLevelItem.id %}
                                                {% set secondLevelName = secondLevelItem.name %}
                                                {% set subcategoryName = secondLevelName|lower %}
                                                {% set secondLevelCustomFields = secondLevelItem.customFields %}
                                                
                                                <div class="subcategory-subitem" 
                                                     data-subcategory-id="{{ secondLevelId }}"
                                                     data-subcategory-url="{{ secondLevelItem.url }}"
                                                     {% if 'heroic' in subcategoryName %}data-difficulty="heroic"{% endif %}
                                                     {% if 'mythic' in subcategoryName %}data-difficulty="mythic"{% endif %}
                                                     {% if secondLevelId == currentCategoryId %}data-current="true"{% endif %}>
                                                    <span class="{% if secondLevelCustomFields.mm_theme_sidebar_bold %}font-bold{% endif %}">
                                                        {{ secondLevelName }}
                                                        {% if secondLevelId == currentCategoryId %}
                                                            <span class="current-indicator">‚Ä¢</span>
                                                        {% endif %}
                                                        {% if 'Badge' in secondLevelName %}
                                                            <span class="item-badge">Badge</span>
                                                        {% endif %}
                                                    </span>
                                                </div>
                                            {% endfor %}
                                        {% endif %}
                                    </div>
                                </div>
                            {% else %}
                                {# Simple category without subcategories #}
                                {% set subcategoryName = firstLevelName|lower %}
                                <div class="subcategory-item{% if firstLevelId == currentCategoryId %} active-current{% endif %}" 
                                     data-subcategory-id="{{ firstLevelId }}"
                                     data-subcategory-url="{{ firstLevelItem.url }}"
                                     {% if 'heroic' in subcategoryName %}data-difficulty="heroic"{% endif %}
                                     {% if 'mythic' in subcategoryName %}data-difficulty="mythic"{% endif %}
                                     {% if firstLevelId == currentCategoryId %}data-current="true"{% endif %}>
                                    <span class="{% if firstLevelCustomFields.mm_theme_sidebar_bold %}font-bold{% endif %}">
                                        {{ firstLevelName }}
                                        {% if firstLevelId == currentCategoryId %}
                                            <span class="current-indicator">‚Ä¢</span>
                                        {% endif %}
                                        {% if 'Badge' in firstLevelName %}
                                            <span class="item-badge">Badge</span>
                                        {% endif %}
                                    </span>
                                </div>
                            {% endif %}
                        {% endfor %}
                    </div>
                {% endif %} 
            </div>
            
            {# –†–∞–∑–¥–µ–ª–∏—Ç–µ–ª—å –º–µ–∂–¥—É –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω–æ–π –∫–∞—Ç–µ–≥–æ—Ä–∏–µ–π –∏ –æ—Å—Ç–∞–ª—å–Ω—ã–º–∏ #}
            <div class="category-separator"></div>
            
        {% endif %}

        {# –û—Ç–æ–±—Ä–∞–∂–∞–µ–º –≤—Å–µ –æ—Å—Ç–∞–ª—å–Ω—ã–µ –∏–≥—Ä–æ–≤—ã–µ –∫–∞—Ç–µ–≥–æ—Ä–∏–∏ #}
        {% if sidebarCategories %}
            {% for gameItem in sidebarCategories %}
                {% if not contextCategory or gameItem.id != contextCategory.id %}
                    {% set category = gameItem %}
                    {% set name = category.name %}
                    {% set categoryId = category.id %}
                    {% set hasChildren = category.hasChildren %}
                    {% set customFields = category.customFields %}
                    
                    <div class="menu-category" 
                         data-category-id="{{ categoryId }}"
                         {% if not hasChildren %}data-category-url="{{ category.url }}"{% endif %}
                         {% if hasChildren %}data-expandable="true"{% endif %}
                         {% if categoryId == currentCategoryId %}data-current="true"{% endif %}>
                        
                        <div class="category-header">
                            {% if category.iconId is defined %}
                                {% set mediaCollection = searchMedia([category.iconId], context.context) %}
                                {% if mediaCollection.count > 0 %}
                                    {% set iconImage = mediaCollection.first %}
                                    <div class="category-icon">
                                        <img src="{{ iconImage.url }}" alt="{{ name }}" loading="lazy">
                                    </div>
                                {% endif %}
                            {% endif %}
                            
                            <span class="category-title{% if customFields.mm_theme_sidebar_bold %} font-bold{% endif %}">
                                {{ name }}
                                {% if categoryId == currentCategoryId %}
                                    <span class="current-indicator">‚Ä¢</span>
                                {% endif %}
                            </span>
                            
                            {% if hasChildren %}
                                <button class="expand-button" data-expand-button>
                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                        <path d="M8 2V14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                        <path d="M2 8L14 8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                    </svg>
                                </button>
                            {% endif %}
                        </div>
                        
                        {% if hasChildren and category.children %}
                            <div class="subcategories" data-subcategories>
                                {% for firstLevelItem in category.children %}
                                    {% set firstLevelId = firstLevelItem.id %}
                                    {% set firstLevelName = firstLevelItem.name %}
                                    {% set hasSubChildren = firstLevelItem.hasChildren %}
                                    {% set firstLevelCustomFields = firstLevelItem.customFields %}
                                    
                                    {% if hasSubChildren %}
                                        {# Category with subcategories #}
                                        <div class="subcategory-group" data-subcategory-group>
                                            <div class="subcategory-title" 
                                                 data-subcategory-id="{{ firstLevelId }}"
                                                 data-subcategory-url="{{ firstLevelItem.url }}"
                                                 data-expandable="true">
                                                <span class="{% if firstLevelCustomFields.mm_theme_sidebar_bold %}font-bold{% endif %}">
                                                    {{ firstLevelName }}
                                                </span>
                                                
                                                <button class="subcategory-expand" data-subcategory-expand>
                                                    <svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" viewBox="0 0 16 16" fill="none">
                                                        <path d="M8 2V14" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                                        <path d="M2 8L14 8" stroke="white" stroke-width="1.5" stroke-linecap="round"/>
                                                    </svg>
                                                </button>
                                            </div>
                                            <div class="subcategory-items" data-subcategory-items>
                                                {% if firstLevelItem.children %}
                                                    {% for secondLevelItem in firstLevelItem.children %}
                                                        {% set secondLevelId = secondLevelItem.id %}
                                                        {% set secondLevelName = secondLevelItem.name %}
                                                        {% set subcategoryName = secondLevelName|lower %}
                                                        {% set secondLevelCustomFields = secondLevelItem.customFields %}
                                                        
                                                        <div class="subcategory-subitem" 
                                                             data-subcategory-id="{{ secondLevelId }}"
                                                             data-subcategory-url="{{ secondLevelItem.url }}"
                                                             {% if 'heroic' in subcategoryName %}data-difficulty="heroic"{% endif %}
                                                             {% if 'mythic' in subcategoryName %}data-difficulty="mythic"{% endif %}>
                                                            <span class="{% if secondLevelCustomFields.mm_theme_sidebar_bold %}font-bold{% endif %}">
                                                                {{ secondLevelName }}
                                                                {% if 'Badge' in secondLevelName %}
                                                                    <span class="item-badge">Badge</span>
                                                                {% endif %}
                                                            </span>
                                                        </div>
                                                    {% endfor %}
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% else %}
                                        {# Simple category without subcategories #}
                                        {% set subcategoryName = firstLevelName|lower %}
                                        <div class="subcategory-item" 
                                             data-subcategory-id="{{ firstLevelId }}"
                                             data-subcategory-url="{{ firstLevelItem.url }}"
                                             {% if 'heroic' in subcategoryName %}data-difficulty="heroic"{% endif %}
                                             {% if 'mythic' in subcategoryName %}data-difficulty="mythic"{% endif %}>
                                            <span class="{% if firstLevelCustomFields.mm_theme_sidebar_bold %}font-bold{% endif %}">
                                                {{ firstLevelName }}
                                                {% if 'Badge' in firstLevelName %}
                                                    <span class="item-badge">Badge</span>
                                                {% endif %}
                                            </span>
                                        </div>
                                    {% endif %}
                                {% endfor %}
                            </div>
                        {% endif %} 
                    </div>
                {% endif %}
            {% endfor %}
        {% endif %}
    </div>

    <!-- Navigation Controls -->
    <div class="menu-footer">
        <button class="show-all-button" data-show-all-button style="display: none;">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                <path d="M6 9L12 15L18 9"/>
            </svg>
            Show All Categories
        </button>
    </div>
</div>
{% endif %}

{% endblock %}